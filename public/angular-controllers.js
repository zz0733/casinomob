app.controller("AboutMeCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){n.loading=!0;t.post("/AboutMe/Init").then(function(t){var i=t.data;$.extend(n,i);n.loading=null});n.joinAgent=function(){r.confirm("确定要加盟股东?").then(function(n){n&&t.post("/AboutMe/JoinAgent").then(function(n){var t=n.data;if(!t.IsSuccess){r.alert(t.ErrorMessage);return}r.alert("成功加盟股东").then(function(){i.location.reload()})})})}}]);app.controller("AboutMeUpdateMemberInfoCtrl",["$scope","$http","$window","$timeout","CustomModalService",function(n,t,i,r,u){t.post("/AboutMe/UpdateMemberInfoInit").then(function(t){var i=t.data;n.params=i.member;i.member.birthday&&r(function(){$("#birthday").datepicker("setValue",i.member.birthday)})});n.updateMemberInfoSubmit=function(r){n.isProcessing=!0;t.post("/AboutMe/UpdateMemberInfoSubmit",r).then(function(t){var r=t.data;n.isProcessing=null;r.IsSuccess?u.alert("您的基本资料已变更成功").then(function(){i.location.href="/AboutMe"}):u.alert("发生错误："+r.ErrorMessage)})};n.help=null;n.showHelp=function(t){n.help=t};n.hideHelp=function(){n.help=null}}]);app.controller("AccountCaptchaDialogCtrl",["$http","$scope","$interval","$modalInstance","captchaId",function(n,t,i,r,u){function e(){initNECaptcha({captchaId:u,element:"#captcha-instance",mode:"embed",onVerify:function(n,t){n||r.close({verify:t.validate})}},function(){},function(t){n.post("/Home/InitNeCaptchaError",{error:t})})}var f=i(function(){typeof initNECaptcha=="function"&&(e(),i.cancel(f))},100);t.dismiss=function(){r.dismiss("cancel")}}]);app.controller("AccountChangeMoneyPasswordCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){function u(){t.post("/Account/CheckMoneyPassword").then(function(t){var i=t.data;if(n.loading=!1,n.isSuccess=i.IsSuccess,i.IsSuccess===!1){n.errorMsg=i.ErrorMessage;return}n.showInitSetting=i.NoSetMoneyPassword})}n.params={};n.loading=!0;u();n.setPassword=function(u,f){if(u.newPassword!==f){n.notConfirm=!0;return}u.IsCreate=!0;n.notConfirm=!1;n.isProcessing=!0;t.post("/Account/ChangeMoneyPasswordSubmit",u).then(function(t){var u=t.data;n.isProcessing=!1;u.IsSuccess?r.alert("您的取款密码已设置成功").then(function(){i.location.href="/"}):r.alert("发生错误："+u.ErrorMessage)})};n.change=function(u,f){if(n.same=!1,n.notConfirm=!1,u.oldPassword==u.newPassword){n.same=!0;return}if(u.newPassword!=f){n.notConfirm=!0;return}n.isProcessing=!0;t.post("/Account/ChangeMoneyPasswordSubmit",u).then(function(t){var u=t.data;n.isProcessing=null;u.IsSuccess?r.alert("您的取款密码已变更成功").then(function(){i.location.href="/"}):r.alert("发生错误："+u.ErrorMessage)})};n.cancel=function(){i.location.href="/"}}]);app.controller("AccountChangePasswordCtrl",["$scope","$window","$http","CookieService","CustomModalService",function(n,t,i,r,u){n.params={};n.showPasswordWeakTip=r.getCookie("PwdTooWeak")==="1";n.change=function(t){n.same=!1;n.formatError=!1;n.notConfirm=!1;var r=new RegExp("^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$").test(n.params.newPassword);if(n.params.oldPassword==n.params.newPassword){n.same=!0;return}if(!r){n.formatError=!0;return}if(n.params.newPassword!=n.confirm){n.notConfirm=!0;return}n.isProcessing=!0;i.post("/Account/ChangePasswordSubmit",t).then(function(t){var i=t.data;n.isProcessing=null;i.IsSuccess?u.alert("您的密码已变更成功，请立即以新密码重新登入").then(function(){location="/Account/SignOut"}):u.alert("发生错误："+i.ErrorMessage)})};n.cancel=function(){t.location.href="/"}}]);app.controller("AccountCtrl",["$scope","$http","$rootScope","DataService","signalrService",function(n,t,i,r,u){n.signOut=function(){n.isProcessing=!0};n.updateBalance=function(){n.updatingBalance||(n.updatingBalance=!0,t.post("/Account/GetMyBalance").then(function(t){var r=t.data;n.updatingBalance=null;i.wallets.my=r}))};u.on("updateMyBalance",function(n){i.wallets.my=n});n.callBackAllWallet=function(){n.updatingBalance||(n.updatingBalance=!0,t.post("/Account/CallBackAllWallet").then(function(t){var r=t.data;n.updatingBalance=null;i.wallets.my=r}))}}]);app.controller("ActivityCtrl",["$scope","ActivityService",function(n,t){t.getActivity().then(function(t){n.activitys=t;n.activitys.length>0&&(n.categories=n.activitys[0].Name)});n.categoryClick=function(t){n.categories=t}}]);app.controller("AgentApplyCtrl",["$scope","$http","$window","$modal","labelService","$location","CustomModalService",function(n,t,i,r,u,f,e){n.params={};n.isShowMore=!1;n.isProcessing=!1;n.moreOptionClick=function(){n.isShowMore=!0};n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;t.post("/AgentApply/GetAgentRegisterSetting").then(function(t){n.agentRegisterSetting=t.data});t.post("/AgentApply/GetAllBanks").then(function(t){n.banks=t.data;n.params.GroupBank=null});n.$watch("params.Mobile",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.Mobile=i)}});n.$watch("params.QQ",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.QQ=i)}});n.updateBankName=function(){n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;this.params.BankAccount=undefined};n.updateAccount=function(){if(this.params.GroupBank!=null&&this.params.BankAccount!=undefined)switch(this.params.GroupBank.AccountFormat){case 1:if(n.chineseIsValid=new RegExp(/^[^\u4e00-\u9fa5]+$/).test(this.params.BankAccount),n.chineseIsValid)n.chineseIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 2:if(n.numberIsValid=new RegExp(/^[0-9]+$/).test(this.params.BankAccount),n.numberIsValid)n.numberIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 3:if(n.numberOrEmailIsValid=new RegExp(/^[0-9]+$/).test(this.params.BankAccount),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else if(n.numberOrEmailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(this.params.BankAccount),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 4:if(n.emailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(this.params.BankAccount),n.emailIsValid)n.emailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}}else n.isValid=!0,n.chineseIsValid=!0,n.numberIsValid=!0,n.numberOrEmailIsValid=!0,n.emailIsValid=!0};n.$watchCollection("[params.GroupBank, params.Province, params.City, params.BankAccount]",function(t,i){var r=$.grep(t,function(i){if(t[0]==null&&i==undefined){n.isBankRequired=!0;return}if(i==""){n.isBankRequired=!0;return}return i!==undefined});switch(r.length){case 0:n.isBankRequired=!1;break;case i.length:n.isBankRequired=!0;break;default:n.isBankRequired=!0}},!0);n.apply=function(){var i=new RegExp("^[A-Za-z][A-Za-z_0-9]{1,14}$").test(n.params.Account);if(!i){e.alert(u.get("Agent.Account_Error")||"代理帐号格式错误");return}if(n.params.Confirm_Password!=n.params.Password){e.alert(u.get("Agent.Different_Password")||"代理密码与确认密码不同");return}if(!n.checkCode){e.alert(u.get("Agent.Empty_Checkcode")||"验证码为空, 请取得验证码");return}if(!n.isValid){$('input[ng-model="params.BankAccount"]').focus();return}n.params.CheckCodeEncrypt=n.checkCode.encrypt;n.isProcessing=!0;n.params.BankName=n.params.GroupBank==null?null:n.params.GroupBank.Name;t.post("/AgentApply/ApplySubmit",n.params).then(function(t){var i=t.data;if(n.isProcessing=!1,i.IsSuccess===!1){e.alert(i.ErrorMessage).then(function(){n.params.checkCode=null;$("#checkcode-input-group input").focus()});return}n.params=null;r.open({templateUrl:"/AgentApply/AgentDialog",controller:"AgentApplyDialogCtrl",scope:n})})}}]);app.controller("AgentApplyDialogCtrl",["$scope","$window","$modalInstance",function(n,t,i){n.isProcess=!1;n.close=function(){i.close()}}]);app.controller("AnyTimeDiscountDetailDialogCtrl",["$http","$scope","$filter","$modalInstance","CustomModalService",function(n,t,i,r,u){function e(){r.dismiss()}function o(){t.receiving=!0;n.post("/AnyTimeDiscount/ReceiveMemberAnyTimeDiscount",null).then(function(n){var f,e,o;if(t.receiving=!1,f=n.data,f.IsSuccess===!1){u.alert(f.ErrorMessage);return}e=i("currency");o=e(f.totalAmount);u.alert("已领取 "+o).then(function(){r.close()})})}function s(){n.post("/AnyTimeDiscount/GetMemberDiscountDetail",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){u.alert(i.ErrorMessage);return}t.loaded=!0;f(i)})}function h(){t.loaded=!1;n.post("/AnyTimeDiscount/RefreshMemberDiscountDetail",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){u.alert(i.ErrorMessage);return}t.loaded=!0;f(i)})}function f(n){t.startTime=n.StartDateTime?moment(n.StartDateTime).format("YYYY/MM/DD HH:mm:ss"):null;t.total=n.TotalAmount;t.qualification=n.Qualification;t.detail=[];angular.forEach(n.Detail,function(n){t.detail.push({id:n.GameTypeId,displayName:n.GameTypeDisplayName,betAmount:n.BetAmount,discountAmount:n.DiscountAmount,categoryDisplayName:n.CategoryDisplayName})})}s();t.dismiss=e;t.receive=o;t.refresh=h}]);app.controller("BetRecordCtrl",["$scope","$q","$http","$timeout","bodyScrollService","CustomModalService",function(n,t,i,r,u,f){function l(){a();var u=i.post("/BetRecord/GetSupplierCategories",{}),f=i.post("/BetRecord/GetKindCategories",{}),o=[u,f];t.all(o).then(function(t){var i=t[0].data,u=t[1].data;n.betRecord.suppliers=i;n.betRecord.kinds=u;$.each(n.betRecord.suppliers,function(n,t){var i=t.Categories;t.isSelected=!0;$.each(i,function(n,t){t.isSelected=!0})});n.betRecord.status.isReady=!0;r(function(){$(function(){$("#betDialog").dialog({autoOpen:!1,minWidth:800});$("#opener").click(function(){$("#betDialog").dialog("open")})})});e();s()});$(document).on("scroll",function(){r(e)});n.$on("$destroy",h)}function a(){$(function(){var t=$("html").attr("meidon-time");n.betRecord.wagersTimeBegin=n.betRecord.payoffTimeBegin=moment(t,"YYYY/MM/DD 00:00:00").format("YYYY/MM/DD 00:00:00");n.betRecord.wagersTimeEnd=n.betRecord.payoffTimeEnd=moment(t,"YYYY/MM/DD 23:59:59").format("YYYY/MM/DD 23:59:59")})}function e(){var r,u,e,t;if(!o&&!n.betRecord.status.isDataAllLoaded&&(r=$("#bet_record").scrollTop()+$("#bet_record").height(),u=$(document).scrollTop()+$(window).height(),!(r-u>1e3))){if(e=c(),n.betRecord.categoriesString==="(无选取)"){n.isSearchCompleted=!0;n.betRecord.status.isDataAllLoaded=!0;return}t={SearchParams:{WagersTimeBegin:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeBegin:"",WagersTimeEnd:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeEnd:"",PayoffTimeBegin:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeBegin:"",PayoffTimeEnd:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeEnd:"",SearchTimeOption:n.betRecord.searchTimeOption,GameCategories:e,UnpayOnly:n.betRecord.unpayOnly},take:30,skip:n.betRecord.lists.length};n.betRecord.categoriesString==="(全选)"&&delete t.SearchParams.GameCategories;n.betRecord.status.isLoading=!0;o=i.post("/BetRecord/SearchBetRecord",t).then(function(i){if(n.betRecord.status.isLoading=!1,n.isSearchCompleted=!0,o=null,!i.data.IsSuccess){f.alert(i.data.ErrorMessage).then(function(){n.betRecord.status.isDataAllLoaded=!0});return}n.betRecord.lists=n.betRecord.lists.concat(i.data.result);i.data.result.length<t.take&&(n.betRecord.status.isDataAllLoaded=!0,h())})}}function s(){var r=c(),t;n.betRecord.categoriesString!=="(无选取)"&&(t={WagersTimeBegin:n.betRecord.wagersTimeBegin,WagersTimeEnd:n.betRecord.wagersTimeEnd,PayoffTimeBegin:n.betRecord.payoffTimeBegin,PayoffTimeEnd:n.betRecord.payoffTimeEnd,SearchTimeOption:n.betRecord.searchTimeOption,GameCategories:r,UnpayOnly:n.betRecord.unpayOnly},n.betRecord.categoriesString==="(全选)"&&delete t.GameCategories,i.post("/BetRecord/GetBetrecordTotalInfo",t).then(function(t){angular.extend(n.total,t.data)}))}function h(){$(document).off("scroll")}function c(){var t=[];return $.each(n.betRecord.suppliers,function(n,i){var r=i.Categories;$.each(r,function(n,i){i.isSelected&&t.push(i.PropertyName)})}),t}n.betRecord={status:{isReady:!1,isLoading:!1,isDataAllLoaded:!1},lists:[],wagersTimeBegin:null,wagersTimeend:null,payoffTimeBegin:null,payoffTimeEnd:null,searchTimeOption:1,unpayOnly:!1,suppliers:[],kinds:[],categoriesString:"(全选)"};n.total={};l();var o;n.betRecord.submit=function(){var t=$(window).scrollTop();n.isSearchCompleted=!1;n.betRecord.lists=[];n.total={};n.betRecord.status.isDataAllLoaded=!1;$(document).on("scroll",function(){r(e)});r(function(){t===$(window).scrollTop()&&r(e)});r(s)};n.allCategories=function(t){$.each(n.betRecord.suppliers,function(n,i){var r=i.Categories;i.isSelected=t;$.each(r,function(n,i){i.isSelected=t})});n.setCategoriesString()};n.selectSupplier=function(t,i){var r=!0;i&&n.allCategories(!1);$.each(n.betRecord.suppliers,function(n,u){var f=u.Categories;t===u.Value&&(i||(r=u.isSelected),u.isSelected=r,$.each(f,function(n,t){t.isSelected=r}))});n.setCategoriesString()};n.selectKind=function(t){var i=[];$.each(t.Categories,function(n,t){i.push(t.PropertyName)});n.allCategories(!1);$.each(n.betRecord.suppliers,function(n,t){var r=t.Categories;$.each(r,function(n,t){var r=$.inArray(t.PropertyName,i)!==-1;r&&(t.isSelected=!0)})});n.setCategoriesString()};n.checkSupplier=function(t){var i=!0;$.each(n.betRecord.suppliers,function(r,u){if(t===u.Text){var f=u.Categories;$.each(f,function(n,t){t.isSelected===!1&&(i=!1)});n.betRecord.suppliers[r].isSelected=i}})};n.setCategoriesString=function(){var t=[],i=0;if($.each(n.betRecord.suppliers,function(n,r){var u=r.Categories;$.each(u,function(n,r){i=i+1;r.isSelected&&t.push(r.ShortName)})}),t.length===i){n.betRecord.categoriesString="(全选)";return}if(t.length===0){n.betRecord.categoriesString="(无选取)";return}if(t.length<=2){n.betRecord.categoriesString=t.join("、");return}if(t.length>2){n.betRecord.categoriesString=t.slice(0,2).join("、")+"...共"+t.length+"个";return}};n.betDetail=function(n){i.post("/BetRecord/GetPlaycheckUrl",{id:n}).then(function(n){var t=n.data;if(t.IsSuccess===!1){f.alert(t.ErrorMessage);return}var r=1024,i=(window.screen.width-r)/2;i<0&&(i=0);window.open(t.url,null,"width="+r+",height=768,top=200,left="+i)})}}]);app.controller("BetRecordPlusCtrl",["$scope","$q","$http","$timeout","bodyScrollService","MeidonTimeService","CustomModalService",function(n,t,i,r,u,f,e){function v(){y();r(function(){n.betRecord.status.isReady=!0;o();l()});$(document).on("scroll",function(){r(o)});n.$on("$destroy",c)}function y(){$(function(){var t=f.getCurrentMeidon();n.betRecord.wagersTimeBegin=n.betRecord.payoffTimeBegin=moment(t,"YYYY/MM/DD 00:00:00").format("YYYY/MM/DD 00:00:00");n.betRecord.wagersTimeEnd=n.betRecord.payoffTimeEnd=moment(t,"YYYY/MM/DD 23:59:59").format("YYYY/MM/DD 23:59:59")})}function o(){var r,u,t;h||n.betRecord.status.isDataAllLoaded||(r=$("#bet_record").scrollTop()+$("#bet_record").height(),u=$(document).scrollTop()+$(window).height(),r-u>1e3)||(t={SearchParams:{WagersTimeBegin:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeBegin:"",WagersTimeEnd:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeEnd:"",PayoffTimeBegin:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeBegin:"",PayoffTimeEnd:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeEnd:"",SearchTimeOption:n.betRecord.searchTimeOption,UnpayOnly:n.betRecord.unpayOnly},take:30,skip:n.betRecord.lists.length},n.betRecord.selectMemberGameCategories!=="all"&&n.betRecord.selectMemberGameCategories!==""&&(t.SearchParams.GameCategories=n.betRecord.selectMemberGameCategories),n.betRecord.status.isLoading=!0,h=i.post("/BetRecord/SearchBetRecord",t).then(function(i){if(n.betRecord.status.isLoading=!1,h=null,!i.data.IsSuccess){e.alert(i.data.ErrorMessage).then(function(){n.betRecord.status.isDataAllLoaded=!0});c();return}n.betRecord.lists=n.betRecord.lists.concat(i.data.result);i.data.result.length<t.take&&(n.betRecord.status.isDataAllLoaded=!0,c())}))}function l(){var t={WagersTimeBegin:n.betRecord.wagersTimeBegin,WagersTimeEnd:n.betRecord.wagersTimeEnd,PayoffTimeBegin:n.betRecord.payoffTimeBegin,PayoffTimeEnd:n.betRecord.payoffTimeEnd,SearchTimeOption:n.betRecord.searchTimeOption,UnpayOnly:n.betRecord.unpayOnly};n.betRecord.selectMemberGameCategories!=="all"&&n.betRecord.selectMemberGameCategories!==""&&(t.GameCategories=n.betRecord.selectMemberGameCategories);i.post("/BetRecord/GetBetrecordTotalInfo",t).then(function(t){angular.extend(n.total,t.data);n.isSearchCompleted=!0})}function c(){$(document).off("scroll")}var h,a,s;n.betRecord={status:{isReady:!1,isLoading:!1,isDataAllLoaded:!1,memberGameCategoriesLoading:!1,showMemberGameCategoryDropdown:!1},lists:[],wagersTimeBegin:null,wagersTimeend:null,payoffTimeBegin:null,payoffTimeEnd:null,searchTimeOption:1,unpayOnly:!1,suppliers:[],kinds:[],allMemberGameCategories:[{Name:"全选",Category:"all"}],selectMemberGameCategories:"all",currentMemberGameCategoriesName:"全选"};n.total={};v();n.betRecord.submit=function(){var t=$(window).scrollTop();n.isSearchCompleted=!1;n.betRecord.lists=[];n.total={};n.betRecord.status.isDataAllLoaded=!1;$(document).on("scroll",function(){r(o)});r(function(){t===$(window).scrollTop()&&r(o)});r(l)};n.betDetail=function(n){i.post("/BetRecord/GetPlaycheckUrl",{id:n}).then(function(n){var t=n.data;if(t.IsSuccess===!1){e.alert(t.ErrorMessage);return}var r=1024,i=(window.screen.width-r)/2;i<0&&(i=0);window.open(t.url,null,"width="+r+",height=768,top=200,left="+i)})};s=!1;n.getMemberGameCategories=function(){if(!a||s){if(s){n.betRecord.status.showMemberGameCategoryDropdown=!n.betRecord.status.showMemberGameCategoryDropdown;return}n.betRecord.status.memberGameCategoriesLoading=!0;a=i.post("/BetRecord/GetMemberGameCategories").then(function(t){n.betRecord.status.memberGameCategoriesLoading=!1;s=!0;t.data.length===0?(n.betRecord.allMemberGameCategories=[{Name:"近期无游戏记录",Category:""}],n.betRecord.selectMemberGameCategories="",n.betRecord.currentMemberGameCategoriesName="近期无游戏记录"):(n.betRecord.allMemberGameCategories=n.betRecord.allMemberGameCategories.concat(t.data),n.betRecord.selectMemberGameCategories="all");n.betRecord.status.showMemberGameCategoryDropdown=!0})}};n.assignGameCategory=function(t,i){n.betRecord.status.showMemberGameCategoryDropdown=!n.betRecord.status.showMemberGameCategoryDropdown;n.betRecord.currentMemberGameCategoriesName=t;n.betRecord.selectMemberGameCategories=i},function(){$(document).on("click",function(){if(n.betRecord.status.showMemberGameCategoryDropdown){n.betRecord.status.showMemberGameCategoryDropdown=!1;n.$apply();return}})}()}]);app.controller("CdnCtrl",["$scope","$http","$sce",function(n,t,i){n.banners=[];n.Contents=[];t.post("/Cdn/GetPromotion").then(function(t){n.banners=n.banners.concat(t.data[0].items)});n.toHtml=function(n){return i.trustAsHtml(n)}}]);$(document).ready(function(){function n(){localStorage.setItem("LobbyNavAction","/Lobby/Activity");var n;n=window.open("/Lobby/Navigation","_lobbyNav","resizable,scrollbars=yes, width=1300, height=960");n.moveTo((screen.width-1300)/2,(screen.height-960)/3);n.focus();$.ajax({url:"/Home/AddLatestActivityClick",method:"POST",dataType:"json"})}function t(){$("body.layout").append('<aside id="service-float" style="position:fixed;right:0;bottom:0;display:inline-block;width:145px;height:160px;z-index:9999"><iframe src="https://cdn.igsttech.com/Web.Portal/_Common/Content/Views/Shared/images/LatestActivity/fish/fish.html" style="width:100%;height:100%;cursor:pointer;"><\/iframe><div class="latest-activity" style="position:absolute;left:0;bottom:0;z-index:4;width:100%;height:100%;cursor:pointer;"><\/div><span class="closed" style="position:absolute;right:0;top:-10px;z-index:5;width:26px;height:26px;cursor:pointer;background:url(\'https://cdn.igsttech.com/Web.Portal/_Common/Content/Views/Shared/images/close.png\');"><\/span><\/aside>').on("click","#service-float .latest-activity",function(){n()}).on("click","#service-float .closed",function(){$("#service-float").hide()})}function i(){var n=angular.element(document.body).injector().get("ActivityService");n.getActivity().then(function(n){n.length>0&&t()})}i()});$(document).ready(function(){function r(t){n();t.stopPropagation()}function n(){$(".atd-banner").hide()}function u(){e().done(function(){n();t.open({templateUrl:"/AnyTimeDiscount/DetailDialog",controller:"AnyTimeDiscountDetailDialogCtrl",windowClass:"modal-atd"}).result.then(function(){},function(){})})}function f(){return $('[ng-controller="SiteMailCountCtrl"]').length==0?!1:$.ajax({url:"/AnyTimeDiscount/GetMemberDiscountTotalAmount",method:"post",dataType:"json"}).done(function(n){if(n.totalAmount>0){var t=i(n.totalAmount);$(".atd-banner .banner-money").text(t);$(".atd-banner").show()}return n.totalAmount}).fail(function(){})}function e(){return $.ajax({url:"/AnyTimeDiscount/DetailDialog",method:"get",dataType:"html"})}if(typeof $.fn.marquee=="function"&&!0){var t=angular.element(document.body).injector().get("$modal"),i=angular.element(document.body).injector().get("currencyFilter");$("body.layout").append('<style>.atd-banner { position: fixed; bottom: 80px; z-index: 999; width: 100%; height: 0; display: none; }.atd-banner .banner-img { background: url("https://cdn.igsttech.com/Web.Portal/_Common/Content/Views/AnyTimeDiscount/images/title.png"); height: 80px; width: 500px; z-index:9999; line-height: 80px; position: relative; cursor: pointer; }.atd-banner .banner-close { position:absolute;right:14px;top:26px;z-index:5;width:28px;height:28px;cursor:pointer; }.atd-banner .banner-content { color: #000; }.atd-banner .banner-money { color: #ff0000; }.modal-atd .atd-frame { display: none; }<\/style>').append('<div id="atd-banner" class="atd-banner"><div class="banner-img text-center"><span class="banner-close"><\/span><span class="banner-content">您有返水 <span class="banner-money"><\/span> 可领取!<\/span><\/div><\/div>');$(".atd-banner").marquee({speed:2e4,pauseOnHover:!0}).on("click",".banner-close",r).on("click",".banner-img",u);f()}});app.controller("CompanyDepositApplicationsCtrl",["$scope","$http",function(n,t){var i=40;n.loadingPromise=null;n.records=[];n.loadMore=function(){if(!n.complete&&!n.loadingPromise){var r=n.records.length;n.loadingPromise=t.post("/AccountRecord/GetCompanyDepositApplications",{count:i,skip:r}).then(function(t){var r=t.data;angular.forEach(r,function(t){n.records.push(t)});n.loadingPromise=null;r&&r.length<i&&(n.complete=!0)})}};n.loadMore()}]);app.controller("CompanyDepositConfirmDialogCtrl",["$scope","$http","$window","$modalInstance","params","depositType","CustomModalService",function(n,t,i,r,u,f,e){n.params=u;n.depositType=f;n.apply=function(){n.isProcessing=!0;t.post("/CompanyDeposit/Apply",u).then(function(t){var i=t.data;n.isProcessing=null;i.IsSuccess?r.close(i.Id):e.alert(i.ErrorMessage).then(function(){r.dismiss()})})};n.cancel=function(){r.dismiss("cancel")}}]);app.controller("CompanyDepositCtrl",["$scope","$http","$modal","$window","CustomModalService",function(n,t,i,r,u){var h,c,o,s,e,f;for(n.view="bank",h=new Date,c=$("html").attr("moment-lang"),$(".date").datepicker({format:"yyyy/mm/dd",language:c,autoclose:!0,todayHighlight:!0}),n.date=$(".date").datepicker("setValue",h).val(),n.hours=[],o=h.getHours().toString(),o.length==1&&(o="0"+o),e=0;e<24;e++)f=e.toString(),f.length==1&&(f="0"+f),f==o&&(n.hour=f),n.hours.push(f);for(n.minutes=[],s=h.getMinutes().toString(),s.length==1&&(s="0"+s),e=0;e<60;e++)f=e.toString(),f.length==1&&(f="0"+f),f==s&&(n.minute=f),n.minutes.push(f);n.params={};n.applyInfo={};n.loading=!0;t.post("/CompanyDeposit/Init").then(function(t){var u=t.data,i,r;n.depositTypes=u.DepositTypes;i=n.min=u.Min;r=n.max=u.Max;n.condition=i!=null&&r!=null?"between":i!=null&&r==null?"more":i==null&&r!=null?"less":"unlimited";n.loading=null});n.isAvailableAmount=function(t){switch(n.condition){case"between":return t>=n.min&&t<=n.max;case"more":return t>=n.min;case"less":return t>0&&t<=n.max;default:return!0}};n.selectBank=function(t,i){n.applyInfo.bank=t;n.params.groupAccountType=i};n.selectAccount=function(t){n.applyInfo.account=t;n.params.accountId=t.Id};n.selectDepositType=function(t){n.applyInfo.depositType=t;switch(t){case"ATM自动柜员机":case"ATM现金入款":n.showBranch=!0;n.branchTitle="ATM所属分行";break;case"银行柜台":n.showBranch=!0;n.branchTitle="银行柜台分行";break;case"手机银行转帐":case"网银转帐":default:n.showBranch=!1}};n.isBankViewAvailable=function(){return!n.orderId};n.isAccountViewAvailable=function(){return!n.orderId&&n.params.bankId||n.params.groupAccountType!="General"};n.isEditViewAvailable=function(){return!n.orderId&&n.params.bankId&&n.params.accountId||n.params.groupAccountType!="General"};n.isCompleteViewAvailable=function(){return n.orderId};n.openConfirmDialog=function(){if(!n.isAvailableAmount(n.params.amount)){u.alert("存入金额不符合限制");return}if(n.params.depositName.length>50){u.alert("存款人姓名不符合限制");return}if(n.params.groupAccountType=="General"&&!n.applyInfo.depositType){u.alert("请选择存款方式");return}if(n.showBranch){if(!n.branchProvince||!n.branchCity||!n.branchOther){u.alert(n.branchTitle+"填写不完整");return}n.params.memo=n.branchProvince+"省"+n.branchCity+n.cityType+n.branchOther}n.params.time=n.date+" "+n.hour+":"+n.minute;var t=i.open({templateUrl:"/CompanyDeposit/ConfirmDialog",controller:"CompanyDepositConfirmDialogCtrl",resolve:{params:function(){return n.params},depositType:function(){return n.applyInfo.depositType}}});t.result.then(function(t){t&&(n.orderId=t,n.switchView("complete"))})};n.switchView=function(i){switch(i){case"bank":n.view="bank";break;case"account":n.isAccountViewAvailable()&&(n.bankId!=n.params.bankId&&(n.params.accountId=null,n.loadingAccounts=!0,n.accounts=null,t.post("/CompanyDeposit/GetMemberCanUseAccounts",{bankName:n.applyInfo.bank,groupAccountType:n.params.groupAccountType}).then(function(t){var i=t.data;n.accounts=i;n.loadingAccounts=null;n.bankId=n.params.bankId})),n.view="account");n.view="account";break;case"edit":n.isEditViewAvailable()&&(n.view="edit",setTimeout(function(){$("#amount").focus();$("#zClip i").zclip({path:"/Scripts/ZeroClipboard.swf",copy:function(){return $(this).prev().text()},beforeCopy:function(){$(this).next().css("display","inline")},afterCopy:function(){$(this).next().fadeOut(3e3)}})}));break;case"complete":n.isCompleteViewAvailable()&&(n.view="complete")}}}]);app.controller("ContactCtrl",["$scope","$http",function(){}]);app.controller("CountryBlockedCtrl",["$scope","$window",function(n,t){var i=window.__siteSetting?window.__siteSetting.LayoutCtrl:{};n.lineChatClick=function(n){var f=(new Date).getTime(),r=588,u=486,e;i&&i.lineChat&&(r=i.lineChat.width?i.lineChat.width:r,u=i.lineChat.height?i.lineChat.height:u);n=n.indexOf("?")!=-1?n+"&_="+f:n+"?_="+f;e=t.open(n,"_open","width="+r+",height="+u);e.focus()};n.qqClick=function(n){var r="http://wpa.qq.com/msgrd?v=3&uin="+n+"&site=qq&menu=yes",u=588,f=486,e;i&&i.QQ&&(r=i.QQ.link?i.QQ.link.replace("QQVal",n):r,u=i.QQ.width?i.QQ.width:u,f=i.QQ.height?i.QQ.height:f);e=t.open(r,"_open","width="+u+",height="+f);e.focus()}}]);app.controller("HomeCtrl",["$scope","$element","$window","$http","$interval",function(n,t,i,r,u){function o(){f&&u.cancel(f);f=u(function(){n.selectedImg=n.selectedImg==e?1:n.selectedImg+1},3e3)}var f,e;n.slideBannerClick=function(){i.open("/Promotion","_self","resizable,scrollbars=yes")};r.post("/Cdn/GetSlider").then(function(t){var i=t.data;e=i.length;n.slideImgs=i;o()});n.changeSelected=function(t){n.selectedImg=t+1;o()}}]);app.controller("JoinAgentCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){n.joinAgent=function(){r.confirm("确定要加盟股东?").then(function(n){n&&t.post("/AboutMe/JoinAgent").then(function(n){var t=n.data;if(!t.IsSuccess){r.alert(t.ErrorMessage);return}r.alert("成功加盟股东").then(function(){i.location.reload()})})})}}]);app.controller("LayoutCtrl",["_env","$location","$scope","$window","ContactInfoService","MarqueeService","MeidonTimeService","CustomModalService",function(n,t,i,r,u,f,e,o){i.env=n.LayoutCtrl;e.on(function(n){i.meiDonNow=n});u.getContactInfo().then(function(n){i.ContactInfo=n});f.getMarquee().then(function(n){i.newsBags=n});i.newsClick=function(){i.isMarqueeShowClass=!0};i.FuYingClick=function(){u.alert("游戏停止合作,即将下架")};i.closeMarquee=function(){i.isMarqueeShowClass=!1};i.noviceClick=function(){var n=r.open("http://pk3755.com/","_open","width=1490,height=650");n.focus()};i.lineChatClick=function(n,t,u,f){var s=(new Date).getTime(),h=t||i.env.lineChat.target,l=u||i.env.lineChat.width,a=f||i.env.lineChat.height,o=n||i.ContactInfo.Live800Link,c,e;o+=o.indexOf("?")!==-1?"&_="+s:"?_="+s;c=h==="_blank"?"":"width="+l+",height="+a;e=r.open(o,h,c);!i.env.lineChat.fullScreen||u||f||(e.moveTo(0,0),e.resizeTo(screen.width,screen.height));e.focus()};i.qqClick=function(n,t,r){var u=t||i.env.QQ.width,f=r||i.env.QQ.height,e=i.env.QQ.link.replace("QQVal",n),o=window.open(e,"_open","width="+u+",height="+f);!i.env.QQ.fullScreen||t||r||(linechat.moveTo(0,0),linechat.resizeTo(screen.width,screen.height));o.focus()};i.FreePlayClick=function(){var n=window.open("/Trial/Apply");n.focus()};i.GpkBingoClick=function(){var n=window.open("http://gpk-gameinfo.com/GALAXYonline.mp4","_open","width=588,height=486");n.focus()};i.liveCasinoClick=function(){var n=window.open("http://gpk-gameinfo.com/Live_casino/","_blank","width=1000,height=800");n.focus()};i.AgentLoginClick=function(){var n=r.open("/daili_dl","_blank");n.focus()};i.RegisterClick=function(){var n=r.open("/Register","_parent");n.focus()};i.AgentApplyClick=function(){var n=r.open("/AgentApply","_parent");n.focus()};i.addFavoriteClick=function(){var n=t.protocol()+"://"+t.host(),i=$(document).prop("title");try{window.external.addFavorite(n,i)}catch(r){try{window.sidebar.addPanel(i,n,"")}catch(r){o.alert("请按 Ctrl+D 键添加到收藏夹","notice")}}};i.addHomePageClick=function(){var n=t.protocol()+"://"+t.host();document.all?(document.body.style.behavior="url(#default#homepage)",document.body.setHomePage(n)):o.alert("您的浏览器目前不支援此功能！")};i.$on("showRegisterDialog",function(){i.toggleRegisterDialog(!0)});i.toggleRegisterDialog=function(n){i.registerDialog=n!==undefined?n:!i.registerDialog}}]);app.controller("LobbiesCtrl",["$scope","$rootScope","LobbyNavService","gameNavigationSortService","CustomModalService",function(n,t,i,r,u){function e(){u.alert("游戏停止合作,即将下架")}function f(n){i.openLobbyNav("/FuYing/playGame?plat_type=BBIN&game_type=1&externalType="+n+"","Bb")}function s(){i.openLobbyNav("/FuYing/playGame?plat_type=BBIN&game_type=1&externalType=","Saba")}function o(n){i.openLobbyNav("/FuYing/playGame?plat_type=AG&game_type=1&externalType="+n,"Ag")}function h(t){angular.forEach(t,function(t){n["to"+t.Name]=c(t)})}function c(n){return function(){n.IsEmbedded?null:i.addToNonEmbedded(n.Name);i.openLobbyNav(n.Url,n.Name)}}n.isLogin=function(){return t.user&&t.user.isLogin};n.maintain=function(){n.isLogin()&&u.alert("升级中")};n.toBbSport=function(){i.openLobbyNav("/FuYing/playGame?plat_type=BBIN&game_type=4","Bb")};n.toBbLottery=function(){i.openLobbyNav("/FuYingcp/bbin.html","Bb")};n.toBbLive=function(){f(3)};n.toBbGame=function(){i.openLobbyNav("/FuYing/bbin.html","Bb")};n.toSabaGame=function(){i.openLobbyNav("/FuYing/playGame?plat_type=IBC&game_type=4","Saba")};n.toSabaESport=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=3&externalType=esports","Saba")};n.toMgLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=mg&game_type=1&externalType="+n,"Mg")};n.toMgFlash=function(){i.openLobbyNav("/FuYing/MG.html","Mg")};n.toLEBOLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=iebo&game_type=1&externalType="+n,"LEBO")};n.toAgLive=function(){o(1)};n.toAgHtml=function(){i.openLobbyNav("/FuYing/AG.html","Ag")};n.toPtLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=PT&game_type=1","Pt")};n.toPtFlash=function(){i.openLobbyNav("/FuYing/pt.html","Pt")};n.toGpiLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=GPI&game_type=1","Gpi")};n.toGpiFlash=function(){i.openLobbyNav("/FuYing/Gpi.html","Gpi")};n.toSingSport=function(){i.openLobbyNav("/FuYing/playGame?plat_type=SS&game_type=4","Sing")};n.toEvoLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=DG&game_type=1","Evo")};n.toGnsHtml=function(){i.openLobbyNav("/FuYing/sa.Html","Gns")};n.toPrgFlash=function(){i.openLobbyNav("/FuYing/pp.html","Prg")};n.toSgFlash=function(){i.openLobbyNav("/FuYing/sg.html","Sg")};n.toHabaHtml=function(){i.openLobbyNav("/FuYing/QT.Html","Haba")};n.toJdbHtml=function(){i.openLobbyNav("/FuYing/Jdb.Html","Jdb")};n.toJdbBoard=function(){i.openLobbyNav("/BoardCasino/JdbHtml","JdbList")};n.toNetentHtml=function(){i.openLobbyNav("/FuYing/fg.Html","NetEnt")};n.toAbLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=ALLBET&game_type=1","Ab")};n.toUgGame=function(){e()};n.toMwHtml=function(){i.openLobbyNav("/FuYing/Mw.Html","Mw")};n.toIgLottery=function(){i.openLobbyNav("/FuYingcp/lg.html","Ig")};n.toIgMarkSix=function(){i.openLobbyNav("/FuYingcp/lg6.html","Ig")};n.toIg1MarkSix=function(){i.openLobbyNav("/FuYingcp/eg.html","Ig")};n.toBgLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=bg&game_type=1","Bg")};n.toLatestGame=function(){i.openLobbyNav("/Lobby/LatestGame","LatestGame")};n.toLatestActivity=function(){i.openLobbyNav("/Lobby/Activity","Activity")};n.toCq9Html=function(){i.openLobbyNav("/FuYing/Cq9.html","Cq9")};n.toGdLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=GD&game_type=1","Gd")};n.toGdHtml=function(){i.openLobbyNav("/SlotCasino/GdHtml","GdList")};n.toRedTigerHtml=function(){i.openLobbyNav("/FuYing/sw.Html","RedTiger")};n.toSunbetLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=SUNBET&game_type=1","Sunbet")};n.toGameArtHtml=function(){i.openLobbyNav("/SlotCasino/GameArtHtml","GameArtList")};n.toPgHtml=function(){i.openLobbyNav("/SlotCasino/PgHtml","PgList")};n.toIsbHtml=function(){i.openLobbyNav("/FuYing/bng.Html","Isb")};n.toCmdSport=function(){i.openLobbyNav("/FuYing/playGame?plat_type=AG&game_type=4","Cmd")};n.toLgHtml=function(){i.openLobbyNav("/SlotCasino/LgHtml","LgList")};n.toKgHtml=function(){i.openLobbyNav("/FuYing/Ky.Html","Kg")};n.toCity761Html=function(){i.openLobbyNav("/BoardCasino/City761Html","City761")};n.toLxLottery=function(){i.openLobbyNav("/FuYingcp/fycp.html","Lx")};n.toRgBoard=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=4791","Rg")};n.toRgBoard2=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=5340","Rg")};n.toPtsHtml=function(){i.openLobbyNav("/FuYing/SG.html","Pts")};n.toEbetLive=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=46","Ebet")};n.toImSport=function(){i.openLobbyNav("/FuYing/playGame?plat_type=ESB&game_type=5","Im")};n.toPngHtml=function(){i.openLobbyNav("/SlotCasino/PngHtml","PngList")};n.toOgLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=OG&game_type=1","Og")};n.toRgLottery=function(){i.openLobbyNav("/FuYingcp/fycp1.html","Rg")};n.toVrLottery=function(){i.openLobbyNav("/FuYingcp/vr.html","Vr")};n.toVr1Lottery=function(){i.openLobbyNav("/FuYing/playGame?plat_type=BG&game_type=3","Vr")};n.toGpkCandy=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=5341","Gpk")};n.toGpkHtml=function(){i.openLobbyNav("/IntegratedGame/GpkHtml","GpkList")};n.toGpkSlot=function(){i.openLobbyNav("/IntegratedGame/GpkHtml?CategoryKey=75","GpkList")};n.toGpkBoard=function(){i.openLobbyNav("/FuYing/mt.Html","Gpk")};n.toFsHtml=function(){i.openLobbyNav("/SlotCasino/FsHtml","FsList")};n.toFsBoard=function(){i.openLobbyNav("/FuYing/leg.Html","Fs")};n.toIboSport=function(){i.openLobbyNav("/FuYing/playGame?plat_type=GJ&game_type=4","Ibo")};n.toIbo1Sport=function(){i.openLobbyNav("/FuYing/playGame?plat_type=AVIA&game_type=5","Ibo")};n.toIbo2Sport=function(){i.openLobbyNav("/FuYing/playGame?plat_type=HC&game_type=5","Ibo")};n.toImsSport=function(){i.openLobbyNav("/FuYing/playGame?plat_type=NEWBB&game_type=4","Ims")};n.toNwBoard=function(){i.openLobbyNav("/FuYing/vg.Html","Nw")};n.toKaHtml=function(){i.openLobbyNav("/SlotCasino/KaHtml","KaList")};n.toSaLive=function(){i.openLobbyNav("/FuYing/playGame?plat_type=SA&game_type=1","Sa")};n.toSaHtml=function(){i.openLobbyNav("/SlotCasino/SaHtml","SaList")};n.toGpk2Html=function(){i.openLobbyNav("/FuYing/fg.Html","Gti")};n.toPsHtml=function(){i.openLobbyNav("/SlotCasino/PsHtml","PlsList")};n.toJsHtml=function(){i.openLobbyNav("/SlotCasino/JsHtml","JsList")};n.toJsBoard=function(){i.openLobbyNav("/BoardCasino/JsHtml","JsList")};n.toRecommendGame=function(){i.openLobbyNav("/Lobby/RecommendGame?CategoryKey=74","RecommendList")};n.toFish=function(){i.openLobbyNav("/SlotCasino/Fish","FishList")};n.toAgFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=AG&game_type=6","Ag")};n.toUgFish=function(){e()};n.toMwFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=MW&game_type=6","Mw")};n.toPtFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=PT&game_type=6&game_code=cashfi","Pt")};n.toJdbFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=JDB&game_type=6&game_code=7_7001","Jdb")};n.toJdbFish2=function(){i.openLobbyNav("/FuYing/playGame?plat_type=JDB&game_type=6&game_code=7_7002","Jdb")};n.toJdbFishMoney=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=26&gId=4794","Jdb")};n.toGnsFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=MT&game_type=6&game_code=PTG0011","Gns")};n.toPgFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=SA&game_type=6","Pg")};n.toPgFish2=function(){i.openLobbyNav("/FuYing/playGame?plat_type=MT&game_type=6&game_code=PTG0045","Pg")};n.toRgFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=CQ9&game_type=6&game_code=AD01","Rg")};n.toRgFish2=function(){i.openLobbyNav("/FuYing/playGame?plat_type=JDB&game_type=6&game_code=7_7003","Rg")};n.toRgCutFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=5316","Rg")};n.toBbFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=BBIN&game_type=6","Bb")};n.toBbFish2=function(){i.openLobbyNav("/FuYing/playGame?plat_type=BBIN&game_type=6&game_code=38001","Bb")};n.toPtsFish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=SW&game_type=6","Pts")};n.toPts2Fish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=SW&game_type=6&game_code=sw_fuqsg","Pts")};n.toCq9Fish=function(){i.openLobbyNav("/FuYing/playGame?plat_type=CQ9&game_type=6","Cq9")};n.toCq9FishGo=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=28&gId=5671","Cq9")};n.toCity761Fish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=51&gId=4761","City761")};n.toFsFishBeauty=function(){i.openLobbyNav("/FuYing/playGame?plat_type=FG&game_type=6&game_code=fish_mm","Fs")};n.toFsFishThunder=function(){i.openLobbyNav("/FuYing/playGame?plat_type=FG&game_type=6&game_code=fish_zj","Fs")};n.toFs2FishThunder=function(){i.openLobbyNav("/FuYing/playGame?plat_type=FG&game_type=6&game_code=fish_3D","Fs")};n.toFsFishBird=function(){i.openLobbyNav("/FuYing/playGame?plat_type=FG&game_type=6&game_code=fish_bn","Fs")};n.toFsFishHappy=function(){i.openLobbyNav("/FuYing/playGame?plat_type=FG&game_type=6","Fs")};n.toFsFishEveryDay=function(){i.openLobbyNav("/FuYing/playGame?plat_type=FG&game_type=6&game_code=fish_tt","Fs")};n.toSaFish=function(){};n.toJsFish=function(){};n.toBbinRule=function(){i.openLobbyNav("http://777.gpk-online.com/","Guide","Guide")};n.toSabaRule=function(){i.openLobbyNav("http://gpk-gameinfo.com/world_cup/brasil02.html","Guide","Guide")};n.toAGRule=function(){i.openLobbyNav("http://gc.ag-game.net/agingame/rules/BAC_TR.htm","Guide","Guide")};n.toMGRule=function(){i.openLobbyNav("https://livegames.gameassists.co.uk/HelpCenter/Diamond/LiveGames/zh-tw/Default.htm#cshid=1","Guide","Guide")};r.getGameEntranceList().then(function(n){h(n)})}]);app.controller("LobbyNavCtrl",["$scope","$window","$timeout","languageService","LobbyNavService","gameNavigationSortService",function(n,t,i,r,u,f){function c(){var t=r.currentLanguage;n.langPropertyName=r.getLangPropertyName(t);f.getGameNavigationSort().then(function(t){n.navInfoList=t}).then(y)}function o(){n.isShow=!((_isUserLogin==="False"||!_isUserLogin)&&n.lobbyAction.indexOf("/Account/LoginTo")==0)}function s(){n.lobbyAction=localStorage.getItem("LobbyNavAction");o()}function l(n){n.IsEmbedded||u.addToNonEmbedded(n.Name);u.openLobbyNav(n.Url,n.Name)}function a(t){n.currentKind=t.NavigationKind}function h(i){function u(){$(i+" .lobbyNav-list").height($(window).innerHeight()-260);$(i+" .lobbyNav-list").mCustomScrollbar({alwaysShowScrollbar:1})}var r=275;e>r&&(n.slideLeft=function(){$(i+" .lobbyNav-category ul").stop(!0,!1).animate({left:8},500)},n.slideRight=function(){$(i+" .lobbyNav-category ul").stop(!0,!1).animate({left:-e+r},500)});$(window).on("resize",u);$(i).on("mouseover",function(){$(i).addClass("slide-show")});$(i).on("mouseleave",function(n){(n.pageX>$(i).width()||n.pageX<0||n.pageY<0||n.pageY>t.innerHeight)&&$(i).removeClass("slide-show")});u()}function v(){n.lobbyAction=localStorage.getItem("LobbyNavAction")||"/Lobby/LatestGame";t.addEventListener("storage",function(t){t.key==="LobbyNavAction"?n.$apply(s):null});t.addEventListener("setActionEvent",s)}function y(){p();i(function(){w();h(".LobbyNav")});n.currentKind=n.navInfoList[0].NavigationKind;n.checkListKind=b;n.isShow=!0;n.openLobbyView=l;n.changeNavKind=a;v();o();h(".LobbyNav")}function p(){for(var r,t=[],i=0;i<n.navInfoList.length;i++)for(r=0;r<n.navInfoList[i].NavigationSortList.length;r++)t.push(n.navInfoList[i].NavigationSortList[r]);angular.forEach(t,function(n,i){t[i]=['.LobbyNav .lobbyNav-list li.navsort[game-box="'+n.Name+'"] {',"    background-image: url('https://cdn.igsttech.com/Multimedia/Navigation/Web/term/"+n.ImageFileName+"');","}"].join("\n")});t.push("<\/style>");angular.element(".style-container").css("display","none").append('<style type="text/css">\n'+t.join("\n"))}function w(){var t=angular.element("ul.lobbyNav-category"),n=0;angular.forEach(t.children(),function(t){n=n+angular.element(t)[0].offsetWidth+2});e=n;t.css("width",n+"px")}function b(n){for(var i=[{kind:1,listClass:"hot-list"},{kind:2,listClass:"new-list"}],t=0;t<i.length;t++)if(i[t].kind==parseInt(n))return i[t].listClass}function b(n){for(var i=[{kind:1,listClass:"hot-list"},{kind:2,listClass:"new-list"}],t=0;t<i.length;t++)if(i[t].kind==parseInt(n))return i[t].listClass}var e=0;c()}]);app.controller("LoginCtrl",["$scope","$http","labelService","$window","$timeout","injectActionService","CustomModalService","captchaService",function(n,t,i,r,u,f,e,o){function p(n){setMaxDigits(129);var t=new RSAKeyPair(a,"",v);return encryptedString(t,n)}function b(u){n.isProcessing=!0;t.post("/Account/GetRSAKey").then(function(f){var s,o;a=f.data.exponent;v=f.data.modulus;s=["length","stringify","extend"],function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)}(s,253);var c=function(n){n=+n;return s[n]},b=JSON[c("0x0")](angular[c("0x1")](angular.extend({},u),h)),l=encodeURIComponent(b),y=100,w=[];for(o=0;o<l[c("0x2")];o+=y)w.push(p(l.substr(o,y)));t.post("/Account/Login",w).then(function(t){var u=t.data,f,o;u.IsSuccess?n.loginToGame!==undefined?(f="/Account/"+decodeURIComponent(n.loginToGame),r.location.href=f,r.top!=r.self&&r.top.location.reload(),r.top.opener.top.opener!==null&&r.top.opener.top.opener.location.reload(),r.top.opener.top.location.reload()):r.location.reload():(o=i.get("Shared.Error_Occurred")||"发生错误",e.alert(o+":"+u.ErrorMessage).then(function(){n.loginParams.checkCode=null;n.isProcessing=!1;$("#check-code-wrapper input").focus()}))})})}var l=["pageX","length","keydown","which","keyCode","mousemove","push"],s,h,a,v,w,c,y;(function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)})(l,481);s=function(n){n=+n;return l[n]};h={_m:[],_t:0,_e:0};$(document).on(s("0x0"),function(n){for(h._m[s("0x1")](n[s("0x2")]),h._m[s("0x1")](n.pageY);h._m[s("0x3")]>200;)h._m.shift()}).on(s("0x4"),function(n){var t=n[s("0x5")]||n[s("0x6")];switch(t){case 9:h._t++;break;case 13:h._e++}});w=f.LoginCtrl.loginAction;n.loginParams={account:$("#login_account").val(),password:$("#login_password").val()};n.isProcessing=!1;n.login=function(t){var r=document.getElementById("agree");if(r.style.display="block",!n.checkCode){e.alert(i.get("Shared.Empty_Checkcode")||"验证码为空, 请取得验证码");return}t.checkCodeEncrypt=n.checkCode.encrypt;n.loginToGame=location.search.split("LoginToGame=")[1];o.verifyViaDialogForLogin().then(function(n){n&&(t.neCaptcha=n.verify);b(t)},function(){})};n.agreement=function(){var t=(screen.width-850)/2,i=(screen.height-800)/3,n=r.open("/Home/Agreement","","resizable,scrollbars=yes, width=900, height=850");n.moveBy(t,i);n.focus()};n.loginOver=!1;c=$("#agree");y=$("#login-box");y.hover(function(){c.fadeIn(1e3);n.loginOver=!n.loginOver},function(){n.loginOver=!n.loginOver});c.hover(function(){n.loginOver=!n.loginOver},function(){c.fadeOut(1e3);n.loginOver=!n.loginOver})}]);app.controller("LoginToGameCtrl",["$scope","$window",function(n,t){n.GameRegisterClick=function(){if(t.top.opener!==null){for(var n=t.top.opener.top,i=t.document.domain;n.opener!==null&&n.opener!==n;)try{n.opener.document.domain==i&&(n.close(),n=n.opener.top)}catch(r){break}t.top.close();n.location.href="/Register"}else t.top.location.href="/Register"}}]);app.controller("OnlineDepositCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){function e(t){switch(n.condition){case"between":return t>=n.min&&t<=n.max;case"more":return t>=n.min;case"less":return t>0&&t<=n.max;default:return!0}}var f=[1e5,5e4,3e4,2e4,9950,9025,8855,7952,7018,6150,5252,4785,4230,3975,3500,2850,2322,1925,1668,1205,1018,800,728,656,589,500,448,400,359,300,256,200,125,109,100,50,1],u=$("html").attr("payment-type");n.loading=!0;t.post("/OnlineDeposit/GetDepositRule",{type:u}).then(function(t){var u=t.data;if(!u.IsSuccess){r.alert("发生错误: "+u.ErrorMessage).then(function(){i.location.reload()});return}n.min=u.Min||1;n.max=u.Max;n.availableAmounts=[];angular.forEach(f,function(t){e(t)&&n.availableAmounts.push(t)});n.availableAmounts.length&&(n.amount=n.availableAmounts[0]);n.loading=null});u==="PointCard"&&(t.post("/OnlineDeposit/GetPointCardFeeSetting").then(function(t){var u=t.data;if(!u.IsSuccess){r.alert("发生错误: "+u.ErrorMessage).then(function(){i.location.reload()});return}n.PointCardFee=u}),n.calculate=function(){var t=n.depositAmount*(n.PointCardFee.Percent/100);n.PointCardFee.FeeMax?t>n.PointCardFee.FeeMax?(n.actualDepositAmount=n.depositAmount-n.PointCardFee.FeeMax,n.depositFee=n.PointCardFee.FeeMax):(n.actualDepositAmount=n.depositAmount-t,n.depositFee=t):(n.actualDepositAmount=n.depositAmount-t,n.depositFee=t)},n.showCalculation=function(t){n.isShowCalculation=t})}]);app.controller("PromotionBetaCtrl",["$scope","$http","$sce","labelService",function(n,t,i,r){function u(t){var i={};if(t===""){$("#loading").html('<span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>伺服器忙碌中，请洽客服人员<\/span>');return}i=t;n.categories=i;n.categories&&n.categories!=[]&&f()}function f(){$("#loading").css("display","none");var t=$.grep(n.categories,function(n){return n.isSelected});t.length==0&&angular.isObject(n.categories[0])&&(n.categories[0].isSelected=!0)}function e(n,i){var r=n===i;/^\<div data\-promotion\=\"loading\"/.test(n.PromotionContent)&&r&&t.get("/Promotion/GetDetail?PromotionId="+i.PromotionId+"").then(function(t){n.PromotionContent=t.data?t.data:'<div class="unload" style="width: 80%; margin: 20% auto;line-height: 50px;text-align: center;background-color:rgba(88,88,88,.5); background-color:#7f7f7f \\9;"><span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>无优惠内容<\/span><\/div>'});n.isSelected=r?!n.isSelected:!1}n.toHtml=function(n){return i.trustAsHtml(n)};n.categoryClick=function(t){for(var i in n.categories)n.categories[i].isSelected=n.categories[i]==t;n.itemClick(null)};n.itemClick=function(t){var i,r;for(i in n.categories)for(r in n.categories[i].items)e(n.categories[i].items[r],t)};$("#un-lobby").append('<div id="loading" style="width: 800px;margin: 20px auto;line-height: 50px;text-align: center;background-color:rgba(255,255,255,.5); background-color:#7f7f7f \\9;"><i class="fa fa-spinner fa-spin" style="margin-right:5px"><\/i>'+(r.get("Common.Loading")||"载入中")+"<\/div>");u(JSON.parse(decodeURI(previewObj)))}]);app.controller("PromotionCtrl",["$scope","$http","$sce","$filter","labelService",function(n,t,i,r,u){function c(){t.post("/Promotion/GetList",{IsWeb:!0}).then(function(n){o(n.data)})}function o(t){var i={},r,f;if(t===""){$("#loading").html('<span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>伺服器忙碌中，请洽客服人员<\/span>');return}if(i=JSON.parse(JSON.stringify(t)),e)n.categories=i;else{for(r in i)for(f in i[r].items)i[r].items[f].PromotionContent='<div data-promotion="loading" style="width: 80%;margin: 20% auto;line-height: 50px;text-align: center;background-color:rgba(88,88,88,.5); background-color:#7f7f7f \\9; color: #333;"><i class="fa fa-spinner fa-spin" style="margin-right:5px"><\/i>'+(u.get("Common.Loading")||"载入中")+"<\/div>";n.categories=i;i={}}n.categories&&n.categories!=[]&&l()}function l(){$("#loading").css("display","none");var t=$.grep(n.categories,function(n){return n.isSelected});t.length==0&&angular.isObject(n.categories[0])&&(n.categories[0].isSelected=!0)}function v(n,i){var u=n===i;/^\<div data\-promotion\=\"loading\"/.test(n.PromotionContent)&&u&&t.get("/Promotion/GetDetail?PromotionId="+i.PromotionId+"").then(function(t){n.PromotionContent=t.data?t.data.replace(/src=\"([^\"])+(png|jpg|gif)\"/g,function(n){return r("filterCdn")(n,"https://cdn2.igsttech.com/")}):'<div class="unload" style="width: 80%; margin: 20% auto;line-height: 50px;text-align: center;background-color:rgba(88,88,88,.5); background-color:#7f7f7f \\9;"><span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>无优惠内容<\/span><\/div>'});n.isSelected=u?!n.isSelected:!1}var e=window.location.pathname.toLowerCase().indexOf("preview")>1,f,s,h;if($("#un-lobby").append('<div id="loading" style="width: 800px;margin: 20px auto;line-height: 50px;text-align: center;background-color:rgba(255,255,255,.5); background-color:#7f7f7f \\9;"><i class="fa fa-spinner fa-spin" style="margin-right:5px"><\/i>'+(u.get("Common.Loading")||"载入中")+"<\/div>"),e){f=_uccm2;window.addEventListener("message",a,!1);function a(n){n.origin==f?o(n.data):console.log("无法对应管端网域")}s=window.location.search;h=$('<iframe src="'+f+"/PromotionManagement/Preview"+s+'" style="display: none;"><\/iframe>');$("body").append(h)}else c();n.toHtml=function(n){return i.trustAsHtml(n)};n.categoryClick=function(t){for(var i in n.categories)n.categories[i].isSelected=n.categories[i]==t;n.itemClick(null)};n.itemClick=function(t){var i,r;for(i in n.categories)for(r in n.categories[i].items)v(n.categories[i].items[r],t)}}]);app.controller("RegisterAgreementCtrl",["$scope","$modalInstance",function(n,t){n.close=function(){t.close()}}]);app.controller("RegisterCtrl",["$scope","$window","$http","$modal","$q","labelService","detectionRobotService","signalrService","CustomModalService","captchaService",function(n,t,i,r,u,f,e,o,s,h){function v(n){setMaxDigits(129);var t=new RSAKeyPair(l,"",a);return encryptedString(t,n)}function y(t){var u,r;if(!l||!a){s.alert((f.get("Register.Different_Password")||"会员密码与确认密码不同")+".").then(function(){n.isProcessing=!1});return}u=["extend","stringify"],function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)}(u,307);var e=function(n){n=+n;return u[n]},w=JSON[e("0x0")](angular[e("0x1")](angular.extend({},t),angular[e("0x1")](c,{_c2:o.getConnectionId2()}))),h=encodeURIComponent(w),y=100,p=[];for(r=0;r<h.length;r+=y)p.push(v(h.substr(r,y)));o.invoke("a",p);i.post("/Register/Submit",t)}var c,l,a;o.connect();o.on("b",function(i){if(i.IsSuccess)setTimeout(function(){$("#btn-submit").focus()}),s.alert(f.get("Register.Successful_Registration")||"注册成功").then(function(){$('[checkcode-type="Register"]').prop("disabled",!0);for(var n=0;n<i.Cookies.length;n++)document.cookie=i.Cookies[n];t.location="/Register/Success"});else{var r=i.ErrorMessage;s.alert(r).then(function(){r&&r.indexOf("找不到此代理商")>=0&&$("#parentAccount").select().focus();n.params.checkCode=null;$("#checkcode-input-group input").focus()})}n.isProcessing=!1});o.invoke("c");o.on("d",function(n){l=n.e;a=n.f});o.reconnected(function(){o.invoke("c");n.isProcessing&&s.alert((f.get("Register.Different_Password")||"会员密码与确认密码不同")+"..").then(function(){n.isProcessing=!1;n.params.checkCode=null;$("#checkcode-input-group input").focus()})});n.params={};n.agree=!0;n.isShowMore=!1;n.openAgreementClick=function(){var n=r.open({templateUrl:"/Register/Agreement",controller:"RegisterAgreementCtrl"})};n.$watch("params.Mobile",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.Mobile=i)}});n.$watch("params.QQAccount",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.QQAccount=i)}});n.register=function(t){var r=new RegExp("^[A-Za-z][A-Za-z_0-9]{1,14}$").test(n.params.Account),u=new RegExp("^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$").test(t.Password),i;if(!r){s.alert(f.get("Register.Account_Error")||"会员帐号格式错误");return}if(!u){s.alert(f.get("Register.Password_Error")||"会员密码格式错误，至少 6 个字符以上，须包含字母及数字");return}if(n.Confirm_Password!=t.Password){s.alert(f.get("Register.Different_Password")||"会员密码与确认密码不同");return}if(n.params.Birthday&&(i=/^\d{4}\/\d{2}\/\d{2}$/g,!i.test(n.params.Birthday))){s.alert(f.get("Register.Birthday_Error")||"出生日期格式错误");return}if(!n.agree){s.alert(f.get("Register.Not_Agree")||"未同意用户注册协议");return}if(!n.checkCode){s.alert(f.get("Register.Empty_Checkcode")||"验证码为空, 请取得验证码");return}t.checkCodeEncrypt=n.checkCode.encrypt;n.isProcessing=!0;e.detectionRobot(t).then(function(){h.verifyViaDialogForRegister().then(function(n){n&&(t.neCaptcha=n.verify);y(t)},function(){})},function(){n.params.checkCode=null;$("#checkcode-input-group input").focus();n.isProcessing=!1;s.alert("注册程序验证失败")})};n.moreOptionClick=function(){n.isShowMore=!0};n.closeMarquee=function(){n.isMarqueeShowClass=!1};n.scope=n;i.post("/Register/GetRegisterSetting").then(function(t){var r=t.data,u,i;if(r.IsSuccess===!1){s.alert(r.ErrorMessage);return}n.registerSetting=r;n.state="ok";u=["form[ng-submit='register(params)']","find","input[required]","length","mousemove","push","pageY","shift","keydown","which","keyCode",":focus","indexOf"],function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)}(u,481);i=function(n){n=+n;return u[n]};setTimeout(function(){var n=$(i("0x0"))[i("0x1")](i("0x2")),t,r;c={_r:n[i("0x3")],_f:0,_k:0,_m:[]};$(document).on(i("0x4"),function(n){for(t=!![],c._m[i("0x5")](n.pageX),c._m[i("0x5")](n[i("0x6")]);c._m[i("0x3")]>200;)c._m[i("0x7")]()}).on(i("0x8"),function(t){var r=t[i("0x9")]||t[i("0xa")];r===9&&setTimeout(function(){n.is(i("0xb"))&&c._f++},0)});r=[9,13,16,17,18,91];n.on("click",function(){t&&(c._f++,t=![])}).on(i("0x8"),function(n){var t=n[i("0x9")]||n[i("0xa")];r[i("0xc")](t)<0&&c._k++})},0)});n.hasOptional=function(){var t,i,r,u;for(t in n.registerSetting)if((i=t.indexOf("IsShow_"),!(i<0))&&(r=n.registerSetting[t],r!=!1)&&(u=n.registerSetting["IsRequired_"+t.split("_")[1]],u==!1))return!0;return!1}}]);app.controller("SiteMailCountCtrl",["$scope","$http","DataService",function(n,t,i){n.MailIsReadCount=i.getValue();t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&i.setValue(n.data.Count)})}]);app.controller("SiteMailCtrl",["$scope","$http","$window","$modal","$timeout","bodyScrollService","DataService","labelService","CustomModalService",function(n,t,i,r,u,f,e,o,s){function w(){n.unRead=e.getValue();t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&e.setValue(n.data.Count)})}function b(){h.inbox&&n.mailbox=="inbox"||h.sentbox&&n.mailbox=="sentbox"||f.getDistanceOfBottom()>1e3||(n.mailbox=="inbox"?a():n.mailbox=="sentbox"&&v())}function a(){h.inbox=k().then(function(n){return g(n)})}function v(){h.sentbox=d().then(function(n){return nt(n)})}function k(){return t.post("/SiteMail/GetInboxList",{Size:c,LastId:n.getInboxListMinId}).then(function(n){return n.data})}function d(){return t.post("/SiteMail/GetSentboxList",{Size:c,LastId:n.getSentboxListMinId}).then(function(n){return n.data})}function g(t){(n.getInboxListMinId=t.LastId,t.InboxMailList.length>0&&(n.mailList.inbox=n.mailList.inbox.concat(t.InboxMailList)),t.InboxMailList.length<c&&(n.isFinish.inbox=!0,y()),n.isFinish.inbox)||(h.inbox=null)}function nt(t){(n.getSentboxListMinId=t.LastId,t.SentboxMailList.length>0&&(n.mailList.sentbox=n.mailList.sentbox.concat(t.SentboxMailList)),t.SentboxMailList.length<c&&(n.isFinish.sentbox=!0,y()),n.isFinish.sentbox)||(h.sentbox=null)}function tt(t){return $.map($.grep(n.mailList[t],function(n){return n.isSelected}),function(n){return n.Id})}function y(){n.isFinish.inbox&&n.isFinish.sentbox&&$(window).off("scroll")}function p(){n.editing&&(CKEDITOR.instances.replyEditor.removeAllListeners(),CKEDITOR.remove(CKEDITOR.instances.replyEditor));n.editing=!1;n.detailMail={}}var c,h,l;n.mailbox="inbox";c=100;h={inbox:null,sentbox:null};n.mailList={inbox:[],sentbox:[]};n.isFinish={inbox:!1,sentbox:!1};n.isAllSelected={inbox:!1,sentbox:!1};l={language:"zh-cn",height:"350",allowedContent:!0,removePlugins:"uploadimage",basicEntities:!1,toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles"]},{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"links",groups:["links"]},{name:"insert",groups:["insert"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]},{name:"tools",groups:["tools"]},{name:"others",groups:["others"]}],removeButtons:"PasteFromWord,Superscript,Subscript,CreateDiv,Image,Flash,Smiley,SpecialChar,PageBreak,Anchor,Iframe,Styles,Format,ShowBlocks"};a();v();w();$(window).scroll(function(){b()});n.allSelect=function(t){$.each(n.mailList[t],function(i,r){r.isSelected=n.isAllSelected[t]})};n.mailSelect=function(t){var i=!1;angular.forEach(n.mailList[t],function(n){n.isSelected||(i=!0)});n.isAllSelected[t]=!i};n.delMail=function(i){function u(){var n={};return i=="inbox"?(n={inboxMailIds:r},t.post("/SiteMail/DeleteInboxMails",n).then(function(n){return n.data})):i=="sentbox"?(n={sentboxMailIds:r},t.post("/SiteMail/DeleteSentboxMails",n).then(function(n){return n.data})):void 0}function f(n){n.IsSuccess||s.alert(n.ErrorMessage)}var r=tt(i);s.confirm(o.get("SiteMail.BatchConfirmDel")+n.countSelected(i)+o.get("SiteMail.BatchDelLetter")).then(function(t){var h,o,s;if(t){for(h=0,o=0;o<n.mailList[i].length;o++)for(s=0;s<r.length;s++)n.mailList[i][o].Id==r[s]&&(n.mailList[i][o].IsRead===!1&&h++,n.mailList[i].splice(o,1));e.setValue(n.unRead.Count-h);u().then(function(n){return f(n)})}})};n.countSelected=function(t){return n.mailList[t].length?n.mailList[t].filter(function(n){return n.isSelected}).length:0};n.markReadState=function(i){for(var f,r=$.map($.grep(n.mailList.inbox,function(n){return i?n.isSelected&&!n.IsRead:n.isSelected&&n.IsRead}),function(n){return n.Id}),u=0;u<n.mailList.inbox.length;u++)for(f=0;f<r.length;f++)n.mailList.inbox[u].Id==r[f]&&(n.mailList.inbox[u].IsRead=i);(i?e.setValue(parseInt(n.unRead.Count)-r.length):e.setValue(parseInt(n.unRead.Count)+r.length),r.length)&&t.post("/SiteMail/SetInboxMailsAsReadOrUnread",{inboxMailIds:r,isRead:i}).then(function(n){n.data.IsSuccess||s.alert(n.data.ErrorMessage)})};n.openNewMail=function(){r.open({templateUrl:"newMailModal",scope:n,controller:["$modalInstance","$scope","$timeout","$http",function(n,t,i,r){t.close=n.close;t.focusOnOpen={};i(function(){l.startupFocus=!1;CKEDITOR.replace("newMail",l);t.focusOnOpen.focus("subject")});t.sentMail=function(){var n=CKEDITOR.instances.newMail.getData(),i;if(!n){s.alert(o.get("SiteMail.ContentEmpty")||"信息内容不能为空白");return}if(n.length>2e3){s.alert(o.get("SiteMail.ContentOver")||"内容超过限定字数");return}t.isprocess=!0;i={Subject:t.subject,MailBody:n};r.post("/SiteMail/SendMail",i).then(function(n){if(t.isProcess=!1,!n.data.IsSuccess){s.alert(n.data.ErrorMessage).then(function(){t.close()});return}t.mailList.sentbox.unshift({Id:n.data.Id,MailId:n.data.MailId,Subject:n.data.Subject,MailBodyPreview:n.data.MailBodyPreview,SendDate:n.data.SendDate});s.alert(o.get("SiteMail.SendSuccess")||"您的信件已送出").then(function(){t.close();t.subject="";CKEDITOR.instances.newMail.setData("")})})}}]})};n.openMail=function(i){r.open({templateUrl:"detailMailModal",scope:n,controller:["$scope","$modalInstance",function(n,i){n.close=function(){p();i.close()};n.editStart=function(){n.editing=!0;n.replySubject="RE:"+n.detailMail.Subject;l.startupFocus=!0;CKEDITOR.replace("replyEditor",l);CKEDITOR.instances.replyEditor.setData('<p><\/p><blockquote><div style="color:#777;font-style: normal;">系统 于 '+moment(n.detailMail.SendDate).format("YYYY/MM/DD (dd) HH:mm")+"寄出<\/div><div>"+n.detailMail.detail+"<\/div><\/blockquote>")};n.replyMail=function(){var i=CKEDITOR.instances.replyEditor.getData(),r;if(!i){s.alert(o.get("SiteMail.ContentEmpty")||"信息内容不能为空白");return}if(n.replySubject.length>50){s.alert(o.get("SiteMail.SubjectOver")||"主旨超过限定字数");return}if(i.length>2e3){s.alert(o.get("SiteMail.ContentOver")||"内容超过限定字数");return}n.replying=!0;r={Subject:n.replySubject,MailBody:i};t.post("/SiteMail/SendMail",r).then(function(t){if(n.replying=!1,!t.data.IsSuccess){s.alert(t.data.ErrorMessage).then(function(){n.close()});return}n.mailList.sentbox.unshift({Id:t.data.Id,MailId:t.data.MailId,Subject:t.data.Subject,MailBodyPreview:t.data.MailBodyPreview,SendDate:t.data.SendDate});s.alert(o.get("SiteMail.Replyed")||"您的信件已回复").then(function(){n.close()})})};n.delDetail=function(i){function r(){var r={};return i=="inbox"?(r={inboxMailIds:n.detailMail.Id},t.post("/SiteMail/DeleteInboxMails",r).then(function(n){return n.data})):i=="sentbox"?(r={sentboxMailIds:n.detailMail.Id},t.post("/SiteMail/DeleteSentboxMails",r).then(function(n){return n.data})):void 0}function u(n){if(!n.IsSuccess){s.alert(n.ErrorMessage);return}}s.confirm(o.get("SiteMail.ConfirmDel")||"确定要删除此信件？").then(function(t){t&&(r().then(function(n){return u(n,i)}),angular.forEach(n.mailList[i],function(t,r){t.Id==n.detailMail.Id&&n.mailList[i].splice(r,1)}),n.close())})}}]}).result.then(function(){},function(){p()});n.detailLoading=!0;n.detailMail=i;n.detailMail.IsRead===!1&&(n.unRead.Count--,e.setValue(n.unRead.Count),angular.forEach(n.mailList.inbox,function(t){t.Id==n.detailMail.Id&&(t.IsRead=!0)}),t.post("/SiteMail/SetInboxMailsAsReadOrUnread",{inboxMailIds:n.detailMail.Id,isRead:!0}).then(function(n){n.data.IsSuccess||s.alert(n.data.ErrorMessage)}));t.post("/SiteMail/GetMailDetail",{mailId:n.detailMail.MailId}).then(function(t){n.detailLoading=!1;t.data.IsSuccess||s.alert(t.data.ErrorMessage);n.detailMail.detail=t.data.MailDetail.MailBody})}}]);app.controller("StationMailCountCtrl",["$scope","$http","DataService",function(n,t,i){n.MailIsReadCount=i.getValue();t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&i.setValue(n.data.Count)})}]);app.controller("TransactionCtrl",["$scope","$http","$modal","MeidonTimeService",function(n,t,i,r){function f(t){u.count=40;u.timeBegin=e(t);n.records=[];n.complete=!1;n.isProcessing=!1;n.state="";n.loadMore()}function e(n){var t=r.getCurrentMeidon();return t.subtract(n,"days").format("YYYY/MM/DD")}var u={};n.selectedBtn=0;n.openDetailDialog=function(n){var t=i.open({templateUrl:"/Transaction/DetailDialog",controller:"TransactionDetailDialogCtrl",resolve:{id:function(){return n}}})};n.loadMore=function(){n.complete||n.isProcessing||(n.isProcessing=!0,u.skip=n.records.length,t.post("/Transaction/Search",u).then(function(t){var i=t.data;n.isProcessing=null;angular.forEach(i.records,function(t){n.records.push(t)});i.records&&i.records.length<u.count&&(n.complete=!0);n.state="ok"}))};n.changeTimeBegin=function(n,t){u.timeEnd=angular.isUndefined(t)?null:e(t);f(n)};t.post("/Transaction/GetSelectItem").then(function(t){var i=t.data;n.selectItems=i.selectItem;n.select=n.selectItems[0]});n.searchType=function(t){n.complete=!1;n.records=[];u.SearchType=t.SelectValue;n.loadMore()};f(0)}]);app.controller("TransactionDetailDialogCtrl",["$scope","$http","$window","$modalInstance","id","CustomModalService",function(n,t,i,r,u,f){n.loading=!0;t.post("/Transaction/GetDetail",{id:u}).then(function(t){var i=t.data;if(!i.IsSuccess){f.alert("发生错误: "+i.ErrorMessage).then(function(){r.close()});return}n.tran=i.Transaction;n.loading=null});n.close=function(){r.close()}}]);app.controller("TransferCtrl",["$scope","$http","$filter","$window","CustomModalService",function(n,t,i,r,u){t.post("/Transaction/TransferInit").then(function(t){var i=t.data;n.balance=i.balance;n.complete=!0});n.submit=function(){if(n.balance-n.money<0){u.alert("余额不足");return}var f=i("customCurrency"),e="转出帐号　："+n.account+"\r金额　　　："+f(n.money)+"\r转帐後余额："+f(n.balance-n.money)+"\r\r确定转帐?";u.confirm(e).then(function(i){if(i){var f={receiveMemberAccount:n.account,money:n.money,moneyPassword:n.password};n.isProcessing=!0;t.post("/Transaction/TransferSubmit",f).then(function(t){var i=t.data;n.isProcessing=null;i.IsSuccess?u.alert("转帐成功").then(function(){r.location.href="/"}):u.alert("发生错误："+i.ErrorMessage)})}})}}]);app.controller("TrialCtrl",["$scope","$http","$window","$location","CustomModalService",function(n,t,i,r,u){function f(n){return/^[0-9]*$/.test(n)}n.apply=function(r){if(!f(r.params.mobile)){u.alert("手机号请输入数字").then(function(){$("#mobile").focus()});return}n.params.checkCodeEncrypt=r.checkCode.encrypt;t.post("/Trial/ApplySubmit",n.params).then(function(t){var r=t.data;if(r.IsSuccess===!1){u.alert(r.ErrorMessage).then(function(){n.params.checkCode=null;n.checkCode=null;$('input[name="checkCode"]').focus()});return}u.alert("试玩帐号申请成功，请联络在线客服索取").then(function(){i.location.href="/Trial/Login"})})};n.login=function(n){t.post("/Trial/LoginSubmit",n.params).then(function(n){var t=n.data;if(t.IsSuccess===!1){u.alert(t.ErrorMessage);return}i.location.href="/"})}}]);app.controller("WalletAdministrationFeeDialogCtrl",["$scope","$http","$window","$modalInstance",function(n,t,i,r){n.showView="loadData";t.post("/WithdrawApplication/AdministrationDetail").then(function(t){var i=t.data;n.records=i;n.records.length==0?n.showView="noData":(n.showView="getData",n.total=0,angular.forEach(i,function(t){t&&t.IsAudit===!1&&t.Amount&&(n.total+=t.Amount)}))});n.close=r.close}]);app.controller("WalletRemittanceDepositCtrl",["$scope","$http","$modal","$filter","CustomModalService","languageService",function(n,t,i,r,u,f){function o(){t.post("/WalletRemittance/GetDepositInfo").then(function(t){var i=t.data;if(n.loading=!1,n.isSuccess=i.IsSuccess,n.depositEnabled=i.DepositEnabled,!i.IsSuccess){n.errorMsg=i.ErrorMessage;return}if(!i.DepositEnabled){n.closeMessage=i.DepositCloseMessage;return}n.min=i.DepositMin||1;n.max=i.DepositMax;n.placeholder=s(i.DepositMin,i.DepositMax)});f.getMultilingual(["WalletRemittance"]).then(function(n){e=n.data})}function s(n,t){return n!=null&&t!=null?r("number")(n)+" ~ "+r("number")(t):n!=null&&t==null?r("number")(n)+" "+(e.WalletRemittance_More||"以上"):n==null&&t!=null?r("number")(t)+" "+(e.WalletRemittance_Less||"以下"):e.WalletRemittance_Unlimited||"未限制"}function h(n){var t='<div class="modal-header"><h3>'+(e.WalletRemittance_DepositInfo||"存款资讯")+'<\/h3><\/div><div class="modal-body"><img src="data:image/jpeg;base64,'+n+'" /><\/div><div class="modal-footer"><button class="btn" ng-click="ok()">'+(e.WalletRemittance_Closed||"关闭")+"<\/button><\/div>";i.open({template:t,controller:["$scope","$modalInstance",function(n,t){n.ok=function(){t.close()}}],windowClass:"qr-modal",backdrop:"static"})}var e;n.loading=!0;n.applyProcessing=!1;o();n.apply=function(i){n.applyProcessing=!0;t.post("/WalletRemittance/SubmitDeposit",{Amount:i.depositAmount}).then(function(t){var i=t.data;if(n.applyProcessing=!1,!i.IsSuccess){u.alert(i.ErrorMessage);return}h(i.Qrcode)})}}]);app.controller("WalletRemittanceWithdrawCtrl",["$scope","$http","$timeout","$modal","CustomModalService","languageService",function(n,t,i,r,u,f){function o(){t.post("/WalletRemittance/GetWithdrawInfo",null).then(function(t){var i=t.data;if(n.loading=!1,n.isSuccess=i.IsSuccess,n.withdrawEnabled=i.WithdrawEnabled,!i.IsSuccess){n.errorMsg=i.ErrorMessage;return}if(!i.WithdrawEnabled){n.closeMessage=i.WithdrawCloseMessage;return}n.balance=i.Balance;n.fee=i.Fee;n.adFee=i.TotalAdministration;n.TotalDiscountCancel=i.TotalDiscountCancel;n.IsPassAudit=i.IsPassAudit;n.min=i.WithdrawMin||1;n.max=i.WithdrawMax;n.condition=s(n.min,n.max);n.caculate();setTimeout(function(){$("#inputAmount").focus()})});f.getMultilingual(["WalletRemittance"]).then(function(n){e=n.data})}function s(n,t){return n!=null&&t!=null?"between":n!=null&&t==null?"more":n==null&&t!=null?"less":"unlimited"}function h(n){var t='<div class="modal-header"><h3>'+(e.WalletRemittance_WithdrawalInfo||"取款资讯")+'<\/h3><\/div><div class="modal-body"><img src="data:image/jpeg;base64,'+n+'" /><\/div><div class="modal-footer"><button class="btn" ng-click="ok()">'+(e.WalletRemittance_Closed||"关闭")+"<\/button><\/div>";r.open({template:t,controller:["$scope","$modalInstance",function(n,t){n.ok=function(){t.close()}}],windowClass:"qr-modal",backdrop:"static"})}var e;n.loading=!0;n.isShowCalculation=!1;n.applyParams={};n.applyProcessing=!1;o();n.apply=function(i){n.isOverdraft||(n.applyProcessing=!0,t.post("/WalletRemittance/SubmitWithdraw",{Amount:i.amount,WithdrawPassword:i.moneyPassword}).then(function(t){var i=t.data;if(n.applyProcessing=!1,!i.IsSuccess){u.alert(i.ErrorMessage);return}h(i.Qrcode)}))};n.caculate=function(){var t=parseInt(n.balance)||0,i=parseInt(n.applyParams.amount)||0,r=parseInt(n.fee)||0,u=parseInt(n.adFee)||0,f=parseInt(n.TotalDiscountCancel)||0;n.isOverdraft=t-i-r-u-f<0};n.showCalculation=function(t){n.isShowCalculation=t};n.showAdministrationFeeDialog=function(){r.open({templateUrl:"/WalletRemittance/AdministrationFeeDialog",controller:"WalletAdministrationFeeDialogCtrl",windowClass:"ad-fee-dialog"})}}]);app.controller("WithdrawApplicationAdministrationFeeDialogCtrl",["$scope","$http","$window","$modalInstance",function(n,t,i,r){n.showView="loadData";t.post("/WithdrawApplication/AdministrationDetail").then(function(t){var i=t.data;n.records=i;n.records.length==0?n.showView="noData":(n.showView="getData",n.total=0,angular.forEach(i,function(t){t&&t.IsAudit===!1&&t.Amount&&(n.total+=t.Amount)}))});n.close=r.close}]);app.controller("WithdrawApplicationCtrl",["$scope","$http","$window","$modal","CustomModalService",function(n,t,i,r,u){function f(t,i){t=t==null?n.min=1:n.min=t;i=n.max=i;n.condition=t!=null&&i!=null?"between":t!=null&&i==null?"more":t==null&&i!=null?"less":"unlimited"}n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;n.confirm={MoneyPassword:""};n.loading=!0;t.post("/WithdrawApplication/Init").then(function(t){var i=t.data;if(n.loading=null,i.IsSuccess===!1){n.isSuccess=i.IsSuccess;n.errorMsg=i.ErrorMessage;return}if(i.NoBank){n.updateBankAccountParams={BankName:i.MemberBanks[0]};n.showBankAccount=!0;n.banks=i.MemberBanks;setTimeout(function(){$("#inputBankName").focus()});i.NoSetMoneyPassword&&(n.showMoneyPassword=!0);return}n.bankAccount=i.BankAccount;n.balance=i.Balance;n.fee=i.Fee;n.adFee=i.TotalAdministration;n.TotalDiscountCancel=i.TotalDiscountCancel;n.IsPassAudit=i.IsPassAudit;f(i.WithdrawMin,i.WithdrawMax);setTimeout(function(){$("#inputAmount").focus()})});n.updateBankName=function(){n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;n.updateBankAccountParams.Account=""};n.updateAccount=function(){var i=n.updateBankAccountParams.BankName.AccountFormat,t=n.updateBankAccountParams.Account;if(t!=undefined)switch(i){case 1:if(n.chineseIsValid=new RegExp(/^[^\u4e00-\u9fa5]+$/).test(t),n.chineseIsValid)n.chineseIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 2:if(n.numberIsValid=new RegExp(/^[0-9]+$/).test(t),n.numberIsValid)n.numberIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 3:if(n.numberOrEmailIsValid=new RegExp(/^[0-9]+$/).test(t),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else if(n.numberOrEmailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(t),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 4:if(n.emailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(t),n.emailIsValid)n.emailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}}else n.isValid=!0,n.chineseIsValid=!0,n.numberIsValid=!0,n.numberOrEmailIsValid=!0,n.emailIsValid=!0};n.updateBankAccount=function(i){if(!i.BankName){u.alert("请填入银行名称");return}if(!i.Province){u.alert("请填入省份");return}if(!i.City){u.alert("请填入城市");return}if(!i.Account){u.alert("请填入银行帐号");return}if(n.showMoneyPassword&&i.MoneyPassword!==n.confirm.MoneyPassword){u.alert("取款密码与确认密码不同");return}if(n.bankAccount){u.alert("银行帐号已设定, 若要更改银行帐号请洽客服");return}if(!n.isValid){$("#inputAccount").focus();return}i.GroupBankId=i.BankName.Id;t.post("/WithdrawApplication/UpdateBankAccount",i).then(function(t){var r=t.data;r.IsSuccess?(n.showMoneyPassword=!1,n.bankAccount=i,n.bankAccount.BankName=i.BankName.Name,n.balance=r.Balance,n.fee=r.Fee,n.adFee=r.Administration,n.TotalDiscountCancel=r.DiscountCancel,n.IsPassAudit=r.IsPassAudit,f(r.Min,r.Max),setTimeout(function(){$("#inputAmount").focus()})):u.alert(r.ErrorMessage)})};n.applyParams={};n.apply=function(r){if(n.isShowApply=!0,!r.amount){u.alert("请填入取款金额");return}if(n.isOverdraft()){u.alert("帐户额余不足");return}t.post("/WithdrawApplication/Apply",r).then(function(t){var r=t.data;n.isShowApply=!1;r.IsSuccess?u.alert("提款申请成功").then(function(){i.location.href="/"}):u.alert(r.ErrorMessage)})};n.showAccount=function(){n.showBankAccount=!0};n.showCalculation=function(t){n.isShowCalculation=t};n.showMinimalAmount=function(){n.isShowMinimalAmount=!0};n.isOverdraft=function(){return n.$eval("balance - applyParams.amount - fee - adFee - TotalDiscountCancel < 0")};n.isWithdrawal=function(){return n.$eval("balance - applyParams.amount - adFee - fee - TotalDiscountCancel < min")};n.showAdministrationFeeDialog=function(){r.open({templateUrl:"/WithdrawApplication/AdministrationFeeDialog",controller:"WithdrawApplicationAdministrationFeeDialogCtrl",windowClass:"ad-fee-dialog"})}}])